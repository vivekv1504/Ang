<div class="analytics-container">
  <nav class="analytics-nav">
    <div class="nav-content">
      <h1 class="logo">ğŸ“Š SipStop Analytics</h1>
      <div class="nav-actions">
        <span class="welcome">Welcome, {{ userName }}</span>
        <button class="btn-products" (click)="goToProductManagement()">
          ğŸ“¦ Products
        </button>
        <button class="btn-profile" routerLink="/profile">
          ğŸ‘¤ Profile
        </button>
        <button class="btn-logout" (click)="logout()">Logout</button>
      </div>
    </div>
  </nav>

  <div class="analytics-content">
    <!-- Stats Cards -->
    <div class="stats-grid">
      <div class="stat-card">
        <div class="stat-icon revenue-icon">ğŸ’°</div>
        <div class="stat-details">
          <p class="stat-label">Total Revenue</p>
          <h2 class="stat-value">${{ stats.totalRevenue.toFixed(2) }}</h2>
          <p class="stat-change" [class.positive]="stats.revenueGrowth >= 0" [class.negative]="stats.revenueGrowth < 0">
            {{ stats.revenueGrowth >= 0 ? 'â†‘' : 'â†“' }} {{ Math.abs(stats.revenueGrowth).toFixed(1) }}% from last month
          </p>
        </div>
      </div>

      <div class="stat-card">
        <div class="stat-icon orders-icon">ğŸ“¦</div>
        <div class="stat-details">
          <p class="stat-label">Total Orders</p>
          <h2 class="stat-value">{{ stats.totalOrders }}</h2>
          <p class="stat-change" [class.positive]="stats.ordersGrowth >= 0" [class.negative]="stats.ordersGrowth < 0">
            {{ stats.ordersGrowth >= 0 ? 'â†‘' : 'â†“' }} {{ Math.abs(stats.ordersGrowth).toFixed(1) }}% from last month
          </p>
        </div>
      </div>

      <div class="stat-card">
        <div class="stat-icon avg-icon">ğŸ“ˆ</div>
        <div class="stat-details">
          <p class="stat-label">Avg. Order Value</p>
          <h2 class="stat-value">${{ stats.averageOrderValue.toFixed(2) }}</h2>
          <p class="stat-change neutral">Per order average</p>
        </div>
      </div>

      <div class="stat-card">
        <div class="stat-icon products-icon">ğŸ·</div>
        <div class="stat-details">
          <p class="stat-label">Total Products</p>
          <h2 class="stat-value">{{ stats.totalProducts }}</h2>
          <p class="stat-change neutral">In inventory</p>
        </div>
      </div>
    </div>

    <!-- Charts Row -->
    <div class="charts-row">
      <!-- Monthly Revenue Chart -->
      <div class="chart-card">
        <h3 class="chart-title">ğŸ“Š Monthly Revenue Trend</h3>
        <div class="bar-chart">
          <div *ngFor="let month of monthlyRevenue" class="bar-item">
            <div class="bar-wrapper">
              <div 
                class="bar" 
                [style.height.%]="getMonthlyBarHeight(month.revenue)"
                [title]="'$' + month.revenue.toFixed(2)">
              </div>
            </div>
            <div class="bar-label">{{ month.month }}</div>
            <div class="bar-value">${{ month.revenue.toFixed(0) }}</div>
          </div>
        </div>
      </div>

      <!-- Category Revenue Chart -->
      <div class="chart-card">
        <h3 class="chart-title">ğŸ·ï¸ Revenue by Category</h3>
        <div class="horizontal-bar-chart">
          <div *ngFor="let cat of categoryData" class="h-bar-item">
            <div class="h-bar-label">{{ cat.category }}</div>
            <div class="h-bar-wrapper">
              <div 
                class="h-bar" 
                [style.width.%]="getRevenueBarWidth(cat.revenue)">
              </div>
            </div>
            <div class="h-bar-value">${{ cat.revenue.toFixed(0) }}</div>
          </div>
        </div>
      </div>
    </div>

    <!-- Time-Based Sales Analysis -->
    <div class="time-analysis-section">
      <div class="section-header">
        <h2 class="section-title">â° Top Selling Products by Time Period</h2>
        <div class="time-period-selector">
          <button 
            class="period-btn"
            [class.active]="selectedTimePeriod === 'week'"
            (click)="selectTimePeriod('week')">
            ğŸ“… This Week
          </button>
          <button 
            class="period-btn"
            [class.active]="selectedTimePeriod === 'month'"
            (click)="selectTimePeriod('month')">
            ğŸ“† This Month
          </button>
          <button 
            class="period-btn"
            [class.active]="selectedTimePeriod === 'year'"
            (click)="selectTimePeriod('year')">
            ğŸ“Š This Year
          </button>
        </div>
      </div>

      <div class="time-analysis-content">
        <!-- Period Summary Card -->
        <div class="period-summary-card">
          <div class="summary-header">
            <h3>{{ getPeriodLabel() }} Performance</h3>
            <div class="summary-badge">
              {{ getCurrentTopProducts().length }} Products Sold
            </div>
          </div>
          <div class="summary-stats">
            <div class="summary-stat">
              <span class="stat-icon">ğŸ’°</span>
              <div class="stat-info">
                <p class="stat-label">Total Revenue</p>
                <h3 class="stat-value">${{ getCurrentRevenue().toFixed(2) }}</h3>
              </div>
            </div>
            <div class="summary-stat">
              <span class="stat-icon">ğŸ“¦</span>
              <div class="stat-info">
                <p class="stat-label">Total Orders</p>
                <h3 class="stat-value">
                  {{ getCurrentPeriodStats()[getCurrentPeriodStats().length - 1]?.orders || 0 }}
                </h3>
              </div>
            </div>
            <div class="summary-stat">
              <span class="stat-icon">ğŸ†</span>
              <div class="stat-info">
                <p class="stat-label">Top Product</p>
                <h3 class="stat-value top-product-name">
                  {{ getCurrentTopProducts()[0]?.product.name || 'N/A' }}
                </h3>
              </div>
            </div>
          </div>
        </div>

        <!-- Top Products List with Visual Bars -->
        <div class="top-products-visual-card">
          <h3 class="card-title">ğŸ† Top 10 Products - {{ getPeriodLabel() }}</h3>
          <div class="visual-products-list">
            <div *ngFor="let item of getCurrentTopProducts(); let i = index" class="visual-product-item">
              <div class="product-rank">
                <span class="rank-number" [class.top-three]="i < 3">{{ i + 1 }}</span>
              </div>
              <div class="product-info">
                <img [src]="item.product.image" [alt]="item.product.name" class="product-image">
                <div class="product-details">
                  <h4 class="product-title">{{ item.product.name }}</h4>
                  <p class="product-category">{{ item.product.category }}</p>
                </div>
              </div>
              <div class="product-metrics">
                <div class="metric">
                  <span class="metric-label">Sold</span>
                  <span class="metric-value">{{ item.sold }} units</span>
                </div>
                <div class="metric">
                  <span class="metric-label">Orders</span>
                  <span class="metric-value">{{ item.orders }}</span>
                </div>
                <div class="metric">
                  <span class="metric-label">Revenue</span>
                  <span class="metric-value revenue">${{ item.revenue.toFixed(2) }}</span>
                </div>
              </div>
              <div class="product-bar-container">
                <div 
                  class="product-bar" 
                  [style.width.%]="getRevenueBarWidthForProduct(item.revenue)"
                  [class.top-one]="i === 0"
                  [class.top-three]="i < 3">
                </div>
              </div>
            </div>
            <div *ngIf="getCurrentTopProducts().length === 0" class="empty-state">
              <div class="empty-icon">ğŸ“Š</div>
              <p>No sales data for {{ getPeriodLabel().toLowerCase() }}</p>
            </div>
          </div>
        </div>

        <!-- Comparison Chart -->
        <div class="comparison-chart-card">
          <h3 class="card-title">ğŸ“ˆ {{ selectedTimePeriod === 'week' ? 'Weekly' : selectedTimePeriod === 'month' ? 'Monthly' : 'Yearly' }} Comparison</h3>
          <div class="comparison-chart">
            <div *ngFor="let stat of getCurrentPeriodStats()" class="comparison-bar-item">
              <div class="comparison-bar-wrapper">
                <div 
                  class="comparison-bar" 
                  [style.height.%]="getComparisonBarHeight(stat.revenue)"
                  [title]="'Revenue: $' + stat.revenue.toFixed(2)">
                  <span class="bar-value">${{ stat.revenue > 1000 ? (stat.revenue / 1000).toFixed(1) + 'K' : stat.revenue.toFixed(0) }}</span>
                </div>
              </div>
              <div class="comparison-label">{{ stat.period }}</div>
              <div class="comparison-details">
                <span class="detail-item">{{ stat.orders }} orders</span>
                <span class="detail-item top-product-label">Top: {{ stat.topProduct }}</span>
              </div>
            </div>
          </div>
        </div>

        <!-- Insights Cards -->
        <div class="insights-grid">
          <div class="insight-card" *ngIf="selectedTimePeriod === 'week'">
            <div class="insight-icon">ğŸ“…</div>
            <h4>Weekly Insight</h4>
            <p>Analyzing last 8 weeks of sales data to identify trends and patterns.</p>
          </div>
          <div class="insight-card" *ngIf="selectedTimePeriod === 'month'">
            <div class="insight-icon">ğŸ“†</div>
            <h4>Monthly Insight</h4>
            <p>Tracking monthly performance over the last 12 months for better forecasting.</p>
          </div>
          <div class="insight-card" *ngIf="selectedTimePeriod === 'year'">
            <div class="insight-icon">ğŸ“Š</div>
            <h4>Yearly Insight</h4>
            <p>Year-over-year comparison showing growth trajectory and seasonal patterns.</p>
          </div>
          
          <div class="insight-card highlight">
            <div class="insight-icon">ğŸ¯</div>
            <h4>Best Performer</h4>
            <p *ngIf="getCurrentTopProducts().length > 0">
              <strong>{{ getCurrentTopProducts()[0].product.name }}</strong> leads with 
              <strong>${{ getCurrentTopProducts()[0].revenue.toFixed(2) }}</strong> in revenue!
            </p>
            <p *ngIf="getCurrentTopProducts().length === 0">No data available yet.</p>
          </div>
        </div>
      </div>
    </div>

    <!-- Tables Row -->
    <div class="tables-row">
      <!-- Top Products -->
      <div class="table-card">
        <h3 class="table-title">ğŸ† Top Selling Products</h3>
        <div class="table-wrapper">
          <table class="data-table">
            <thead>
              <tr>
                <th>Product</th>
                <th>Sold</th>
                <th>Revenue</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let item of topProducts; let i = index">
                <td>
                  <div class="product-cell">
                    <span class="rank">{{ i + 1 }}</span>
                    <img [src]="item.product.image" [alt]="item.product.name" class="product-thumb">
                    <span class="product-name">{{ item.product.name }}</span>
                  </div>
                </td>
                <td class="text-center">
                  <span class="badge badge-blue">{{ item.sold }} units</span>
                </td>
                <td class="text-right">
                  <strong class="revenue-text">${{ item.revenue.toFixed(2) }}</strong>
                </td>
              </tr>
            </tbody>
          </table>
          <div *ngIf="topProducts.length === 0" class="empty-state">
            <p>No sales data available yet</p>
          </div>
        </div>
      </div>

      <!-- Recent Orders -->
      <div class="table-card">
        <h3 class="table-title">ğŸ•’ Recent Orders</h3>
        <div class="table-wrapper">
          <table class="data-table">
            <thead>
              <tr>
                <th>Order #</th>
                <th>Customer</th>
                <th>Status</th>
                <th>Total</th>
                <th>Date</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let order of recentOrders">
                <td>
                  <strong>{{ order.orderNumber }}</strong>
                </td>
                <td>{{ order.customerName }}</td>
                <td>
                  <span class="status-badge" [ngClass]="getStatusClass(order.status)">
                    {{ order.status }}
                  </span>
                </td>
                <td class="text-right">
                  <strong>${{ order.total.toFixed(2) }}</strong>
                </td>
                <td class="text-muted">{{ formatDate(order.date) }}</td>
              </tr>
            </tbody>
          </table>
          <div *ngIf="recentOrders.length === 0" class="empty-state">
            <p>No orders yet</p>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

